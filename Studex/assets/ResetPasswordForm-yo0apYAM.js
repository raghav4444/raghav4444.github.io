import{r as t,j as e,s as d}from"./index-DZbrHQV2.js";import{C as q}from"./check-circle-C8EvquJ3.js";import{X as U}from"./x-DHTgq_OJ.js";import{L as N}from"./lock-BXrfucv7.js";import{E as v}from"./eye-off-CXoOaDZE.js";import{E as k}from"./eye-CrXXpMyE.js";import"./createLucideIcon-z6xmPMoH.js";const G=()=>{const[i,P]=t.useState(""),[b,S]=t.useState(""),[u,C]=t.useState(!1),[m,E]=t.useState(!1),[o,r]=t.useState(""),[R,I]=t.useState(!1),[f,w]=t.useState(!1),[g,p]=t.useState(!1);t.useEffect(()=>{(async()=>{try{const{data:s,error:y}=await d.auth.getSession();if(y){console.error("Session error:",y),r("Invalid or expired reset link. Please request a new password reset.");return}if(s.session)console.log("Valid session found for password reset"),p(!0);else{const h=new URLSearchParams(window.location.search),x=new URLSearchParams(window.location.hash.substring(1));let n=h.get("access_token"),l=h.get("refresh_token"),c=h.get("type");if((!c||!n||!l)&&(c=x.get("type"),n=x.get("access_token"),l=x.get("refresh_token")),console.log("ðŸ” ResetPasswordForm: Found tokens:",{type:c,hasAccessToken:!!n,hasRefreshToken:!!l,search:window.location.search,hash:window.location.hash}),c==="recovery"&&n&&l){console.log("Found recovery tokens in URL, setting session...");const{error:j}=await d.auth.setSession({access_token:n,refresh_token:l});j?(console.error("Error setting session:",j),r("Invalid or expired reset link. Please request a new password reset.")):(console.log("Session set successfully"),p(!0))}else r("Invalid or expired reset link. Please request a new password reset.")}}catch(s){console.error("Error handling auth callback:",s),r("Invalid or expired reset link. Please request a new password reset.")}})()},[]);const L=async a=>{if(a.preventDefault(),r(""),i.length<6){r("Password must be at least 6 characters long.");return}if(i!==b){r("Passwords do not match.");return}w(!0);try{const{error:s}=await d.auth.updateUser({password:i});if(s)throw s;await d.auth.signOut(),I(!0)}catch(s){r(s instanceof Error?s.message:"Failed to reset password. Please try again.")}finally{w(!1)}};return R?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-[#0d1117] to-[#161b22] p-4",children:e.jsxs("div",{className:"bg-[#161b22] rounded-lg p-8 border border-gray-800 w-full max-w-md text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(q,{className:"w-8 h-8 text-green-400"})}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Password Reset Successful!"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"Your password has been successfully updated. You can now sign in with your new password."}),e.jsx("button",{onClick:()=>{const s=window.location.hostname==="localhost"?"/":"/Studex/";window.location.href=s},className:"px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white font-medium rounded-lg transition-colors",children:"Go to Sign In"})]})}):!g&&!o?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-[#0d1117] to-[#161b22] p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-lg animate-pulse mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Verifying reset link..."})]})}):o&&!g?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-[#0d1117] to-[#161b22] p-4",children:e.jsxs("div",{className:"bg-[#161b22] rounded-lg p-8 border border-gray-800 w-full max-w-md text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(U,{className:"w-8 h-8 text-red-400"})}),e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Invalid Reset Link"}),e.jsx("p",{className:"text-gray-400 mb-6",children:o}),e.jsx("button",{onClick:()=>window.location.href="/",className:"px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white font-medium rounded-lg transition-colors",children:"Go to Home"})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-[#0d1117] to-[#161b22] p-4",children:e.jsxs("div",{className:"bg-[#161b22] rounded-lg p-8 border border-gray-800 w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Reset Your Password"}),e.jsx("p",{className:"text-gray-400",children:"Enter your new password below"})]}),e.jsxs("form",{onSubmit:L,className:"space-y-6",children:[o&&e.jsx("div",{className:"bg-red-500/10 border border-red-500/20 rounded-lg p-3",children:e.jsx("p",{className:"text-red-400 text-sm",children:o})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(N,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:u?"text":"password",value:i,onChange:a=>P(a.target.value),className:"w-full pl-10 pr-12 py-3 bg-[#0d1117] border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 focus:outline-none transition-all",placeholder:"Enter new password",required:!0}),e.jsx("button",{type:"button",onClick:()=>C(!u),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white transition-colors",children:u?e.jsx(v,{className:"w-5 h-5"}):e.jsx(k,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Confirm New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(N,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:m?"text":"password",value:b,onChange:a=>S(a.target.value),className:"w-full pl-10 pr-12 py-3 bg-[#0d1117] border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 focus:outline-none transition-all",placeholder:"Confirm new password",required:!0}),e.jsx("button",{type:"button",onClick:()=>E(!m),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white transition-colors",children:m?e.jsx(v,{className:"w-5 h-5"}):e.jsx(k,{className:"w-5 h-5"})})]})]}),e.jsx("button",{type:"submit",disabled:f,className:"w-full py-3 bg-blue-500 hover:bg-blue-600 disabled:bg-blue-500/50 text-white font-medium rounded-lg transition-all duration-200 focus:ring-2 focus:ring-blue-500/20 focus:outline-none",children:f?"Updating Password...":"Update Password"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-gray-400 text-sm",children:["Remember your password?"," ",e.jsx("a",{href:"/",className:"text-blue-400 hover:text-blue-300 font-medium transition-colors",children:"Sign in here"})]})})]})})};export{G as default};
